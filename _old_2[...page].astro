---
import type { GetStaticPaths } from "astro";
import Layout from "../../layouts/Layout.astro";
import ResourceFilter from "../../components/ResourceFilter.astro";
import ResourceList from "../../components/ResourceList.astro";
import ResourceTOC from "../../components/ResourceTOC.astro";
import CommentList from "../../components/CommentList.astro";
import { getCollection, getEntry } from "astro:content";

/*export async function getStaticPaths() {
	const allSections = (await getCollection('sections')).sort((a, b) => a.data.sortOrder - b.data.sortOrder);
	const allResources = (
		await getCollection("resources")
	).sort((a, b) => new Date(a.data.pubDate).valueOf() - new Date(b.data.pubDate).valueOf()); // ordering by publication date

	const paths = allSections.map(section => {
		const [currentSection, ...slug] = section.slug.split('/');
		console.log(section, currentSection, slug);
		return { params: { section: currentSection, slug: slug.join('/') || undefined }, props: section }
	})

	return paths;
}*/

/*export async function getStaticPaths({ paginate }: any) {
	const allSections = (await getCollection('sections')).sort((a, b) => a.data.sortOrder - b.data.sortOrder);
	const allResources = (
		await getCollection("resources")
	).sort((a, b) => new Date(a.data.pubDate).valueOf() - new Date(b.data.pubDate).valueOf()); // ordering by publication date
	return allSections.flatMap((currentSection: any) => {
		const s = currentSection.slug;
		const filteredResources = allResources.filter((resource: any) => ( resource.data.section.slug === currentSection.slug ));
		//console.log('SECTION = ',currentSection, s, filteredResources, paginate(filteredResources, { params: { id: currentSection.slug }, pageSize: 1}));
		return paginate(filteredResources, {
			params: { section: s },
			props: { currentSection },
			pageSize: 1
		});
	});
}*/

//console.log(Astro.params, Astro.props);

const { section, page } = Astro.props;
const params = Astro.params;
const currentSection = Astro.url.pathname.split("/")[1];
const section2 = await getEntry("sections", currentSection);
const { Content } = await section2.render();
---

section2
{JSON.stringify(section2)}

<pre>Astro.params
{JSON.stringify(Astro.params)}
</pre>

page
{JSON.stringify(page)}


<pre>params
{JSON.stringify(params)}
</pre>

<h1>{page.data.title}</h1>
<Content />

<Layout title="Resurse de Front End Development - Resurse.dev" description="@TODO: scrie descrierea" template="SectionPage">
	<div class="Hero" id="hero">
		<div class="HeroVisual">
			<img class="HeroImage" src={section.data.image?.imageUrl} width="287" height="120" alt={section.data.image?.imageAlt} />
		</div>
		<div class="HeroText">
			<h1 class="HeroTitle">{section.data.title}</h1>
			<details class="HeroDetails">
				<summary class="HeroPreview">
					<p class="HeroP">{section.data.shortDescription}</p>
					<p class="HeroP"><span class="HeroExpand Link" title=`Afișează întreg textul descriptiv pentru resursele de ${section.data.menu}`>Citește mai mult &raquo;</span></p>
				</summary>
				<div class="HeroContent">
					<Content />
				</div>
			</details>
		</div>
	</div>
	<main class="Main">
		<ResourceFilter />
		<ResourceList resources={page.data} page={page} />
		<ResourceTOC section={section} />
		<CommentList />
	</main>
</Layout>